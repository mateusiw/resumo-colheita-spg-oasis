<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resumo de Colheita SPG Oásis - 2026</title>
    
    <!-- Configurações PWA -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"SPG Oásis 2026","short_name":"SPG Oásis","start_url":".","display":"standalone","background_color":"#ffffff","theme_color":"#ffffff","icons":[{"src":"https://i.imgur.com/qKTYiGT.png","sizes":"512x512","type":"image/png"}]}'>
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SPG Oásis">
    
    <link rel="apple-touch-icon" href="https://i.imgur.com/qKTYiGT.png">
    <link rel="icon" type="image/png" href="https://i.imgur.com/qKTYiGT.png">

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Fix para ícones no html2canvas */
        .icon-fix { 
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            width: 14px; 
            height: 14px; 
            min-width: 14px; /* Impede encolhimento */
        }
        .icon-fix svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen pb-20 select-none">

    <!-- Navbar -->
    <div class="bg-white border-b border-slate-200 px-4 py-3 flex justify-between items-center shadow-sm sticky top-0 z-40">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center border border-slate-100 overflow-hidden">
                <img src="https://i.imgur.com/qKTYiGT.png" alt="Logo" class="w-full h-full object-contain p-0.5">
            </div>
            <div>
                <h1 class="text-sm font-bold text-slate-800 leading-tight">SPG Oásis</h1>
                <p class="text-[10px] text-slate-500 font-medium">Resumo de Colheita SPG Oásis</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button type="button" onclick="downloadImage()" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-bold shadow-lg shadow-emerald-600/20 transition-all active:scale-95 active:bg-emerald-800">
                <i data-lucide="download" class="w-4 h-4"></i>
                <span>Baixar</span>
            </button>
        </div>
    </div>

    <div class="container mx-auto p-4 flex flex-col lg:flex-row gap-8 mt-4">
        
        <!-- COLUNA DA ESQUERDA: CONTROLES -->
        <div class="w-full lg:w-1/3 space-y-4">
            
            <!-- 1. DADOS GERAIS DO DIA (Operacional) -->
            <div class="bg-blue-50 p-6 rounded-2xl shadow-sm border border-blue-100">
                <h2 class="text-sm font-bold text-blue-800 mb-3 flex items-center gap-2">
                    <i data-lucide="clock" class="text-blue-600"></i> Dados Gerais do Dia
                </h2>
                <div class="text-[10px] text-blue-600/70 mb-3">* Estes dados aparecem uma vez no final do relatório.</div>
                
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div>
                        <label class="text-[10px] font-bold text-slate-500">Qtd Pessoas</label>
                        <input type="text" id="crewCount" oninput="renderReport()" placeholder="Ex: 5" class="w-full p-2 border border-blue-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-500">Estimativas de Caixas</label>
                        <input type="text" id="estimatedBoxes" oninput="renderReport()" placeholder="Ex: 200" class="w-full p-2 border border-blue-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="text-[10px] font-bold text-slate-500">Início</label>
                        <input type="time" id="startTime" oninput="renderReport()" class="w-full p-2 border border-blue-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-500">Final</label>
                        <input type="time" id="endTime" oninput="renderReport()" class="w-full p-2 border border-blue-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-500">Intervalo (Min)</label>
                        <input type="number" id="intervalDuration" oninput="renderReport()" placeholder="60" class="w-full p-2 border border-blue-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>
            </div>

            <!-- 2. ADICIONAR BLOCOS -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                        <i data-lucide="file-plus" class="text-emerald-600"></i> Adicionar Bloco
                    </h2>
                    <button type="button" onclick="clearBlockForm()" class="text-xs font-semibold text-slate-400 hover:text-red-500 transition-colors flex items-center gap-1">
                        <i data-lucide="eraser" class="w-3 h-3"></i> Limpar Campos
                    </button>
                </div>
                
                <form id="harvestForm" onsubmit="addItem(event)" class="space-y-3">
                    
                    <!-- CAMPO BLOCO -->
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Nº Bloco</label>
                        <input type="text" id="talhao" placeholder="Ex: 1 - B" required class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none text-sm">
                    </div>

                    <!-- LINHA DE VARIEDADE E COMERCIAL -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase">Cultura</label>
                            <select id="variety" required class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none text-sm bg-white">
                                <option value="">Selecione...</option>
                                <option value="Brócolis">Brócolis</option>
                                <option value="Couve-Flor">Couve-Flor</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase">Var. Comercial</label>
                            <input type="text" id="commercialVariety" placeholder="Ex: Avenger" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none text-sm">
                        </div>
                    </div>

                    <!-- INFORMAÇÕES ADICIONAIS -->
                    <div class="border-t border-slate-100 my-2 pt-2">
                        <label class="text-xs font-bold text-slate-400 block mb-2">Informações Adicionais</label>
                        
                        <!-- Linha 1: Datas -->
                        <div class="grid grid-cols-2 gap-3 mb-2">
                            <div>
                                <label class="text-[10px] font-bold text-slate-500">Início de Colheita</label>
                                <input type="date" id="startDate" required class="w-full p-2 border border-slate-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-emerald-500 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500">DAT</label>
                                <input type="date" id="date" required class="w-full p-2 border border-slate-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-emerald-500 outline-none">
                            </div>
                        </div>

                        <!-- Linha 2: Quantidades Iniciais -->
                        <div class="grid grid-cols-2 gap-3 mb-2">
                            <div>
                                <label class="text-[10px] font-bold text-slate-500">Transplantio (Qtd)</label>
                                <input type="text" id="plants" placeholder="Ex: 10.000" class="w-full p-2 border border-slate-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500">Total de Unidades</label>
                                <input type="text" id="totalUnits" placeholder="Ex: 5.000" class="w-full p-2 border border-slate-300 rounded-lg text-sm">
                            </div>
                        </div>

                        <!-- Linha 3: Caixas e Dia -->
                        <div class="grid grid-cols-2 gap-2 mb-2">
                             <div>
                                <label class="text-[10px] font-bold text-slate-500">Caixas</label>
                                <input type="text" id="boxes" placeholder="Ex: 50" class="w-full p-2 border border-slate-300 rounded-lg text-sm">
                            </div>
                             <div>
                                <label class="text-[10px] font-bold text-slate-500">Unidades (hoje)</label>
                                <input type="text" id="dailyUnits" placeholder="Ex: 5.000" class="w-full p-2 border border-slate-300 rounded-lg text-sm">
                            </div>
                        </div>

                        <div class="text-[10px] text-slate-400 mt-2 italic flex flex-col">
                            <span>* Percentual: Automático</span>
                            <span>* Dias Produção: Automático</span>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl transition-all flex justify-center items-center gap-2 mt-4 active:scale-95">
                        <i data-lucide="plus-circle" class="w-4 h-4"></i> Adicionar ao Relatório
                    </button>
                </form>
            </div>

            <!-- Lista de Itens -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-sm font-bold text-slate-700">Itens Gerados</h3>
                    <button onclick="clearAll()" class="text-xs text-red-500 hover:text-red-700 font-bold underline">Limpar Tudo</button>
                </div>
                <ul id="itemsList" class="space-y-2 text-sm text-slate-600">
                    <!-- JS -->
                </ul>
            </div>
        </div>

        <!-- PREVIEW -->
        <div class="w-full lg:w-2/3 flex justify-center items-start bg-slate-200/50 p-4 rounded-3xl border border-slate-300/50 min-h-[600px]">
            
            <div id="report-card" class="w-full max-w-sm bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100 relative">
                
                <!-- Cabeçalho -->
                <div class="bg-gradient-to-br from-emerald-600 to-emerald-800 p-6 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4">
                        <img src="https://i.imgur.com/qKTYiGT.png" alt="Logo" class="w-24 h-24 object-contain opacity-50">
                    </div>
                    
                    <div class="relative z-10">
                        <h2 class="text-2xl font-bold tracking-tight mb-4">Resumo de Produção</h2>
                        
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                            <span id="headerDateTime" class="text-lg font-bold text-white tracking-wide font-mono">
                                Colheita: --/--/----
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo -->
                <div id="reportContent" class="divide-y divide-slate-50 min-h-[100px]">
                    <div class="p-8 text-center text-slate-400 text-xs italic">Adicione blocos...</div>
                </div>

                <!-- Operacional Footer -->
                <div id="operationalFooter" class="bg-slate-50 border-t border-slate-200 p-4">
                     <!-- Conteúdo injetado via JS -->
                </div>

                <!-- Rodapé da Marca -->
                <div class="bg-slate-100 p-3 text-center border-t border-slate-200">
                    <div class="flex justify-center items-center gap-2 text-[10px] text-slate-400 font-medium uppercase tracking-widest">
                        <img src="https://i.imgur.com/qKTYiGT.png" alt="Logo" class="w-4 h-4 object-contain opacity-50">
                        SPG Oásis • Dados Oficiais
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        let harvestData = [];

        lucide.createIcons();
        updateDateHeader();
        renderList(); 
        renderReport(); 

        function updateDateHeader() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            
            document.getElementById('headerDateTime').innerText = `Colheita: ${day}/${month}/${year}`;
        }

        function calculateTimeDifference(start, end, interval) {
            if (!start || !end || start === "--:--" || end === "--:--") return "--:--";

            const [startH, startM] = start.split(':').map(Number);
            const [endH, endM] = end.split(':').map(Number);
            
            let startMin = startH * 60 + startM;
            let endMin = endH * 60 + endM;
            let intervalMin = parseInt(interval) || 0;

            let diff = endMin - startMin - intervalMin;
            
            if (diff < 0) return "Erro";

            const hours = Math.floor(diff / 60);
            const minutes = diff % 60;

            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        function calculateDaysFromStart(isoDateStr) {
            if (!isoDateStr) return 0;
            const [year, month, day] = isoDateStr.split('-').map(Number);
            const start = new Date(year, month - 1, day);
            const now = new Date();
            start.setHours(0,0,0,0);
            now.setHours(0,0,0,0);
            const diffTime = now - start; 
            if(diffTime < 0) return 0;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            return diffDays; 
        }

        function parsePTBRNumber(val) {
            if (!val) return 0;
            const cleanStr = val.toString().replace(/\./g, '').replace(',', '.');
            return parseFloat(cleanStr) || 0;
        }

        function formatDateBR(isoStr) {
            if(!isoStr) return "";
            const [year, month, day] = isoStr.split('-');
            return `${day}/${month}/${year}`;
        }

        function clearBlockForm() {
            document.getElementById('talhao').value = '';
            document.getElementById('commercialVariety').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('date').value = '';
            document.getElementById('plants').value = '';
            document.getElementById('totalUnits').value = '';
            document.getElementById('boxes').value = '';
            document.getElementById('dailyUnits').value = '';
            document.getElementById('variety').selectedIndex = 0; 
        }

        function addItem(e) {
            e.preventDefault();

            const plantsRaw = document.getElementById('plants').value;
            const totalUnitsRaw = document.getElementById('totalUnits').value;
            const startDateVal = document.getElementById('startDate').value;
            const dateVal = document.getElementById('date').value; 

            const plantsVal = parsePTBRNumber(plantsRaw);
            const totalUnitsVal = parsePTBRNumber(totalUnitsRaw);
            let calculatedPercentage = 0;
            if (plantsVal > 0) {
                calculatedPercentage = Math.round((totalUnitsVal / plantsVal) * 100);
            }

            const calculatedDays = calculateDaysFromStart(startDateVal);
            const formattedStartDate = formatDateBR(startDateVal);
            const formattedDate = formatDateBR(dateVal);

            const newItem = {
                talhao: document.getElementById('talhao').value,
                variety: document.getElementById('variety').value,
                commercialVariety: document.getElementById('commercialVariety').value,
                percentage: calculatedPercentage, 
                startDate: formattedStartDate,    
                date: formattedDate, 
                plants: plantsRaw, 
                dailyUnits: document.getElementById('dailyUnits').value,
                boxes: document.getElementById('boxes').value,
                totalUnits: totalUnitsRaw, 
                days: calculatedDays, 
            };

            harvestData.push(newItem);
            renderReport();
            renderList();
        }

        function removeItem(index) {
            harvestData.splice(index, 1);
            renderReport();
            renderList();
        }

        function clearAll() {
            if(confirm('Tem certeza?')) {
                harvestData = [];
                renderReport();
                renderList();
            }
        }

        function renderList() {
            const list = document.getElementById('itemsList');
            list.innerHTML = '';

            if (harvestData.length === 0) {
                const emptyLi = document.createElement('li');
                emptyLi.className = "text-center text-slate-400 italic py-2";
                emptyLi.innerText = "Nenhum bloco adicionado.";
                list.appendChild(emptyLi);
                return;
            }

            harvestData.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center bg-slate-50 p-2 rounded border border-slate-100";
                li.innerHTML = `
                    <span><b>#${item.talhao}</b> - ${item.variety}</span>
                    <button onclick="removeItem(${index})" class="text-red-500 hover:bg-red-50 p-1 rounded">
                        <i data-lucide="trash-2" width="14"></i>
                    </button>
                `;
                list.appendChild(li);
            });
            lucide.createIcons();
        }

        function renderReport() {
            const container = document.getElementById('reportContent');
            const footerContainer = document.getElementById('operationalFooter');

            container.innerHTML = '';
            let sumBoxes = 0;
            let sumDailyUnits = 0;

            if (harvestData.length === 0) {
                container.innerHTML = `<div class="p-8 text-center text-slate-400 text-xs italic">Adicione dados no formulário ao lado para visualizar.</div>`;
            } else {
                harvestData.forEach(item => {
                    let progressColor = 'bg-yellow-500';
                    let textColor = 'text-slate-600';
                    if (item.percentage >= 90) { progressColor = 'bg-emerald-500'; textColor = 'text-emerald-600'; }
                    else if (item.percentage >= 70) { progressColor = 'bg-blue-500'; }

                    const displayVariety = item.commercialVariety ? `${item.variety} - ${item.commercialVariety}` : item.variety;
                    const remainingPercentage = Math.max(0, 100 - item.percentage);
                    
                    sumBoxes += parsePTBRNumber(item.boxes);
                    sumDailyUnits += parsePTBRNumber(item.dailyUnits);

                    const html = `
                    <div class="p-5 hover:bg-slate-50 transition-colors group">
                        <!-- Topo com Progresso -->
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex flex-col gap-1 w-2/3">
                                <div class="flex items-center gap-2">
                                    <span class="text-base font-bold text-slate-800">
                                        Bloco ${item.talhao}
                                    </span>
                                    <div class="flex items-center gap-1">
                                        <i data-lucide="tag" class="text-slate-400" width="10"></i>
                                        <span class="text-[10px] font-bold text-slate-500 uppercase">${displayVariety}</span>
                                    </div>
                                </div>
                                <div class="mt-2 w-full">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="text-[10px] font-bold text-emerald-600">(%) Colhido: ${item.percentage}%</div>
                                        <div class="text-[10px] font-medium text-slate-400">
                                            Total: <b>${item.totalUnits}</b> <span class="mx-1">•</span> Falta: <b>${remainingPercentage}%</b>
                                        </div>
                                    </div>
                                    <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                                        <div class="h-full rounded-full ${progressColor}" style="width: ${item.percentage}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Grid de Estatísticas (SEM BORDAS) -->
                        <div class="flex flex-col gap-2">
                            <!-- Linha 1 -->
                            <div class="grid grid-cols-1 gap-2">
                                ${createStatItem('leaf', item.plants, 'Transplantio')}
                            </div>
                            
                            <!-- Linha 2 -->
                            <div class="grid grid-cols-2 gap-2">
                                 <div class="flex flex-col items-center justify-center p-2 rounded-xl bg-slate-50">
                                    <div class="mb-1 text-slate-400"><i data-lucide="calendar" width="14"></i></div>
                                    <span class="text-xs font-bold text-slate-700">${item.date}</span>
                                    <span class="text-[9px] uppercase tracking-wider font-semibold text-slate-400">DAT</span>
                                </div>
                                <div class="flex flex-col items-center justify-center p-2 rounded-xl bg-slate-50">
                                    <div class="mb-1 text-slate-400"><i data-lucide="calendar-days" width="14"></i></div>
                                    <span class="text-xs font-bold text-slate-700">${item.startDate}</span>
                                    <span class="text-[9px] uppercase tracking-wider font-semibold text-slate-400">Início de Colheita</span>
                                </div>
                            </div>

                            <!-- Linha 3 -->
                            <div class="grid grid-cols-2 gap-2">
                                ${createStatItem('box', item.boxes, 'Caixas', true)}
                                ${createStatItem('package', item.dailyUnits, 'Unidades (hoje)')}
                            </div>
                        </div>

                        <div class="mt-3 flex items-center justify-between text-[10px] text-slate-400 font-medium bg-slate-50/50 px-2 py-1.5 rounded-lg">
                            <span class="flex items-center gap-1">
                                <i data-lucide="refresh-cw" width="10"></i> Dias de Produção: ${item.days} dias
                            </span>
                        </div>
                    </div>
                    `;
                    container.innerHTML += html;
                });
            }

            const crew = document.getElementById('crewCount').value || '-';
            const est = document.getElementById('estimatedBoxes').value || '-';
            const start = document.getElementById('startTime').value || '--:--';
            const end = document.getElementById('endTime').value || '--:--';
            const interval = document.getElementById('intervalDuration').value || '0';
            
            const totalHours = calculateTimeDifference(start, end, interval);
            const sumBoxesStr = sumBoxes.toLocaleString('pt-BR');
            const sumDailyUnitsStr = sumDailyUnits.toLocaleString('pt-BR');

            footerContainer.innerHTML = `
                <!-- NOVO PAINEL DE TOTAIS -->
                <div class="bg-emerald-50 rounded-lg p-3 mb-3 flex justify-around items-center">
                    <div class="text-center">
                        <div class="text-[10px] text-emerald-600 font-bold uppercase mb-0.5">Total Caixas</div>
                        <div class="text-lg font-extrabold text-emerald-800">${sumBoxesStr}</div>
                    </div>
                    <div class="w-px h-8 bg-emerald-200"></div>
                    <div class="text-center">
                        <div class="text-[10px] text-emerald-600 font-bold uppercase mb-0.5">Total Unidades</div>
                        <div class="text-lg font-extrabold text-emerald-800">${sumDailyUnitsStr}</div>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-3 pb-3 border-b border-slate-200 border-dashed">
                     <div class="flex items-center gap-2">
                        <i data-lucide="users" class="text-slate-400 icon-fix"></i>
                        <span class="text-[10px] font-bold text-slate-600">Equipe: <span class="text-slate-800 text-xs">${crew}</span></span>
                    </div>
                     <div class="flex items-center gap-2">
                        <i data-lucide="package-search" class="text-emerald-500 icon-fix"></i>
                        <span class="text-[10px] font-bold text-emerald-700">Estimativas de Caixas: <span class="text-xs">${est} Cx</span></span>
                    </div>
                </div>
                
                <div class="grid grid-cols-4 gap-1 text-[10px] text-slate-500 font-medium mb-1">
                    <div class="flex flex-col items-center bg-white p-1 rounded">
                        <span class="text-green-500 font-bold mb-0.5">Início</span>
                        ${start}
                    </div>
                    <div class="flex flex-col items-center bg-white p-1 rounded">
                        <span class="text-red-500 font-bold mb-0.5">Final</span>
                        ${end}
                    </div>
                    <div class="flex flex-col items-center bg-white p-1 rounded">
                        <span class="text-amber-500 font-bold mb-0.5">Interv.</span>
                        ${interval} min
                    </div>
                    <div class="flex flex-col items-center bg-slate-800 text-white p-1 rounded shadow-sm">
                        <span class="text-emerald-300 font-bold mb-0.5">Total</span>
                        ${totalHours} h
                    </div>
                </div>
            `;

            lucide.createIcons();
        }

        // Helper (CORRIGIDO: FIX ICON SIZE E ALIGNMENT)
        function createStatItem(iconName, value, label, highlight = false) {
            const textColor = highlight ? 'text-emerald-800' : 'text-slate-700';
            const labelColor = highlight ? 'text-emerald-600/70' : 'text-slate-400';
            const iconColor = highlight ? 'text-emerald-600' : 'text-slate-400';
            const bgColor = highlight ? 'bg-emerald-50/50' : 'bg-slate-50';

            return `
            <div class="flex flex-col items-center justify-center p-2 rounded-xl ${bgColor}">
                <div class="mb-1 ${iconColor} icon-fix"><i data-lucide="${iconName}"></i></div>
                <span class="text-xs font-bold ${textColor}">${value}</span>
                <span class="text-[9px] uppercase tracking-wider font-semibold ${labelColor}">${label}</span>
            </div>
            `;
        }

        function downloadImage() {
            const element = document.getElementById('report-card');
            if (!element) return;
            const originalText = document.querySelector('button[onclick="downloadImage()"] span').innerText;
            document.querySelector('button[onclick="downloadImage()"] span').innerText = "Gerando...";
            setTimeout(() => {
                html2canvas(element, { scale: 3, backgroundColor: null, useCORS: true }).then(canvas => {
                    const image = canvas.toDataURL("image/png");
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = `Relatorio-SPG-Oasis-${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    document.querySelector('button[onclick="downloadImage()"] span').innerText = originalText;
                }).catch(err => {
                    alert("Erro: " + err);
                    document.querySelector('button[onclick="downloadImage()"] span').innerText = originalText;
                });
            }, 100);
        }
    </script>
</body>
</html>
